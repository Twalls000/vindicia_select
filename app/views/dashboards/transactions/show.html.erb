<h3 class='thin'><%= @transaction.merchant_transaction_id %></h4>
<a href="#audit-trails">Audit Trails</a>
<hr>

<% @transaction.attributes.each do |name,value| %>
  <div class="row">
    <div class="col s12">
      <h5 class="thin"><%= name.to_s.titleize %></h5>
      <pre><%= value.inspect %></pre>
    </div>
  </div>
<% end %>
<hr>
<div id="audit-trails">
  <h4 class="thin">Audit Trails</h4>
  <ul class="collapsible popout collapsible-accordion" data-collapsible="accordion">
    <% @audit_trails.each do |audit_trail| %>
      <li class="<%= audit_trail.type.underscore %>">
        <div class="collapsible-header">
          <i class="medium material-icons">
            <%= audit_trail.is_a?(SuccessAuditTrail) ? "check" : "clear" %>
          </i>&nbsp;
          <%= audit_trail.type %>&nbsp;
          (<%= audit_trail.created_at.strftime("%b %d %Y %H:%M:%S %z") %>)
        </div>
        <div class="collapsible-body" style="padding: 10px;">
          <% [:id, :type, :created_at, :soap_id, :changed_values].each do |attr| %>
            <h6><%= attr.to_s.titleize %></h6>
            <pre><%= audit_trail[attr.to_s].inspect %></pre>
          <% end %>
          <% [:event, :exception].each do |attr| %>
            <h6><%= attr.to_s.titleize %></h6>
            <p><%= audit_trail[attr.to_s] %></p>
          <% end %>
        </div>
      </li>
    <% end %>
  </ul>
</div>
<style media="screen">
  .failure_audit_trail .collapsible-header {
    background-color: darkred !important;
    color: white;
  }
  .success_audit_trail .collapsible-header {
    background-color: green !important;
    color: white;
  }
</style>
